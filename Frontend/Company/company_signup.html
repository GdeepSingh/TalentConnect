<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Employer Sign Up • TalentConnect</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>

<div class="bg-dot"></div>
<div class="bg-shape a"></div>
<div class="bg-shape b"></div>

<header class="site-header">
  <div class="site-header__inner">
    <div class="brand"><div class="brand__logo"></div><div class="brand__name">TalentConnect</div></div>
    <div class="muted">Already have an account? <a href="company_login.html">Log in</a></div>
  </div>
</header>

<main class="container">
  <section class="card">
    <h1 class="card__title">Create Employer Account</h1>
    <p class="card__note">Sign up to manage jobs & applicants.</p>

    <form id="signupForm">

      <label>Full Name</label>
      <input id="name" type="text" required>

      <label>Email</label>
      <input id="email" type="email" required>

      <label>Password</label>
      <input id="password" type="password" required>

      <label>Are you the first person from this company?</label>
      <select id="ownerCheck">
        <option value="yes">Yes, I am the company owner</option>
        <option value="no">No, I have a company code</option>
      </select>

      <div id="codeBox" style="display:none;">
        <label>Enter Company Code</label>
        <input id="companyCodeInput" type="text" placeholder="XXXX-XXXX">
      </div>

      <div class="actions">
        <button class="btn btn--primary" type="submit">Create Account</button>
      </div>

      <p id="msg" class="card__note"></p>
    </form>
  </section>
</main>

<script>
function generateCode(){
  const chars="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  let s="";
  for(let i=0;i<8;i++) s+=chars[Math.floor(Math.random()*chars.length)];
  return s.slice(0,4)+"-"+s.slice(4);
}

document.getElementById("ownerCheck").addEventListener("change", e=>{
  document.getElementById("codeBox").style.display = 
    e.target.value==="no" ? "block" : "none";
});

document.getElementById("signupForm").addEventListener("submit", e=>{
  e.preventDefault();
  let name=document.getElementById("name").value.trim();
  let email=document.getElementById("email").value.trim();
  let pass=document.getElementById("password").value.trim();
  let owner=document.getElementById("ownerCheck").value;
  let inputCode=document.getElementById("companyCodeInput").value.trim();
  let msg=document.getElementById("msg");

  let users=JSON.parse(localStorage.getItem("tc_users"))||[];
  if(users.find(u=>u.email===email)) {
    msg.textContent="❌ Email already exists.";
    msg.style.color="red";
    return;
  }

  let companies=JSON.parse(localStorage.getItem("tc_companies"))||{};
  let finalCode="";

  if(owner==="yes"){
    finalCode=generateCode();
    companies[finalCode]={ owner:email, employees:[email] };
  } else {
    if(!companies[inputCode]) {
      msg.textContent="❌ Invalid company code.";
      msg.style.color="red";
      return;
    }
    finalCode=inputCode;
    companies[inputCode].employees.push(email);
  }

  let newUser={
    name,email,password:pass,role:"employer",
    companyCode:finalCode
  };

  users.push(newUser);
  localStorage.setItem("tc_users",JSON.stringify(users));
  localStorage.setItem("tc_companies",JSON.stringify(companies));
  localStorage.setItem("tc_active_user",JSON.stringify(newUser));

  window.location.href="company_dashboard.html";
});
</script>

</body>
</html>
