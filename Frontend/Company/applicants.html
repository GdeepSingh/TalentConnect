<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Applicants · TalentConnect</title>
  <link rel="stylesheet" href="../css/style.css"/>

  <style>
.card.wide{width:900px;}
.cards-wrap{
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:14px;
  max-height:520px;
  scrollbar-width:none;
}
.muted{color:#6b7280}
.pill{display:inline-block;padding:.2rem .6rem;border-radius:999px;font-size:.8rem}
.pill--ok{background:#dcfce7;color:#166534}
.pill--bad{background:#fee2e2;color:#991b1b}
.divider{height:1px;background:var(--border);opacity:.8;margin:.5rem 0 1rem}
.summary{display:flex;gap:.6rem;flex-wrap:wrap}
.summary span{background:#f3f4f6;border:1px solid var(--border);border-radius:999px;padding:.25rem .6rem;font-size:.9rem}
  </style>
</head>

<body>

<header class="site-header">
  <div class="site-header__inner">
    <a href="company_dashboard.html" class="brand">
      <span class="brand__logo"></span>
      <span class="brand__name">TalentConnect</span>
    </a>
    <nav style="display:flex;gap:12px;">
      <a class="btn btn--ghost" href="company_dashboard.html">Dashboard</a>
      <a class="btn btn--ghost" href="post_job.html">Post a Job</a>
      <a class="btn btn--ghost" href="manage_jobs.html">Manage Jobs</a>
      <a class="btn btn--ghost" href="applicants.html">Applicants</a>
      <a class="btn btn--ghost" href="company_profile.html">Company Profile</a>
      <a class="btn" href="company_login.html">Sign out</a>
    </nav>
  </div>
</header>

<main class="container">

  <div class="card wide">
    <p class="card__title">Applicants</p>
    <p class="card__note">Review candidates by role. Status updates auto-save.</p>

    <div class="summary" id="summaryBox"></div>
    <div class="divider"></div>

    <div class="cards-wrap" id="cards"></div>
  </div>

</main>

<footer class="site-footer">
  <p>© 2025 TalentConnect · Employers Portal</p>
</footer>


<script>
/* ============ STORAGE HELPERS ============ */
const getJobs       = () => JSON.parse(localStorage.getItem("tc_jobs")) || [];
const getApplicants = () => JSON.parse(localStorage.getItem("tc_applicants")) || {};
const saveApplicants = d => localStorage.setItem("tc_applicants", JSON.stringify(d));

/* ========== RENDERING MAIN FUNCTION ========== */
function renderApplicants(){
  const jobs = getJobs();
  const apps = getApplicants();
  const wrap = document.getElementById("cards");
  const summary = document.getElementById("summaryBox");

  wrap.innerHTML = "";

  let TOTAL=0, NEW=0, SHORT=0, REJ=0;

  for(const job of jobs){
    const arr = apps[job.id] || [];
    arr.forEach(app => {

      TOTAL++;
      if(app.status==="NEW") NEW++;
      if(app.status==="SHORTLISTED") SHORT++;
      if(app.status==="REJECTED") REJ++;

      wrap.innerHTML += `
      <div class="card" style="margin:0;">
        <div style="display:flex;justify-content:space-between;">
          <p style="font-weight:600;margin:.2rem 0;">${app.name}</p>
          <span class="pill ${badge(app.status)}">${pretty(app.status)}</span>
        </div>

        <p class="card__note">${app.exp ?? ""}</p>

        <button class="btn" style="margin:.3rem 0;">Applied: ${job.title}</button>

        <label class="muted" style="font-size:.85rem;">Action</label>
        <div class="actions">
          <select onchange="updateStatus('${job.id}','${app.id}',this.value)">
            <option>— Select Action —</option>
            <option value="VIEW">View Resume</option>
            <option value="SHORTLIST">Shortlist</option>
            <option value="REJECT">Reject</option>
          </select>
          <a class="btn" href="${app.resume ?? "#"}" target="_blank">Open</a>
        </div>
      </div>
      `;
    });
  }

  summary.innerHTML = `
    <span>Total: ${TOTAL}</span>
    <span>New: ${NEW}</span>
    <span>Shortlisted: ${SHORT}</span>
    <span>Rejected: ${REJ}</span>
  `;

  if(TOTAL===0){
    wrap.innerHTML = `<p style="padding:20px;">No applicants yet.</p>`;
  }
}

/* ========== UPDATE STATUS ========== */
function updateStatus(jobId, appId, action){
  if(action==="VIEW") return;

  const apps = getApplicants();
  const list = apps[jobId];
  const app = list.find(a => a.id===appId);

  app.status = (action==="SHORTLIST") ? "SHORTLISTED" : "REJECTED";

  saveApplicants(apps);
  renderApplicants();
}

/* ========== HELPERS ========== */
const pretty = s => s.charAt(0) + s.slice(1).toLowerCase();
const badge  = s => s==="REJECTED" ? "pill--bad" : "pill--ok";

/* BOOT */
renderApplicants();
</script>

</body>
</html>
