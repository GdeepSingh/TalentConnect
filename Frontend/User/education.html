<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Education â€¢ TalentConnect</title>
  <link rel="stylesheet" href="../css/style.css" />

<style>
.edu-box {
  border: 1px solid var(--border);
  padding: 10px 14px;
  border-radius: 8px;
  background: #f9fafb;
  margin-bottom: 10px;
}

.edu-title {
  font-weight: 700;
  font-size: 1rem;
  margin-bottom: 4px;
}

.edu-dates {
  font-size: 0.85rem;
  color: #555;
}

.edu-delete {
  color: red;
  font-size: 0.8rem;
  cursor: pointer;
  float: right;
}
</style>

</head>

<body>

<header class="site-header">
  <div class="site-header__inner">
    <div class="brand">
      <div class="brand__logo"></div>
      <div class="brand__name">TalentConnect</div>
    </div>
    <div class="muted">Step <strong>3</strong> of 4</div>
  </div>
</header>

<main class="container">

  <!-- STEPPER -->
  <div class="stepper">
    <div class="stepper__dot stepper__dot--done"></div>
    <div class="stepper__dot stepper__dot--done"></div>
    <div class="stepper__dot stepper__dot--active"></div>
    <div class="stepper__dot"></div>
  </div>

  <!-- CARD -->
  <section class="card">

    <h1 class="card__title">Education</h1>
    <p class="card__note">Add your most recent education. You can add more.</p>

    <!-- ðŸ”¹ Saved education shows here -->
    <div id="eduList"></div>

    <!-- ðŸ”¹ FORM -->
    <form id="eduForm" novalidate>

      <label>School / College</label>
      <input id="school" type="text" placeholder="e.g., Langara College" />

      <div class="row">
        <div>
          <label>Degree</label>
          <input id="degree" type="text" placeholder="e.g., Diploma, B.Sc." />
        </div>
        <div>
          <label>Field of Study</label>
          <input id="field" type="text" placeholder="e.g., Computer Science" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Start Year</label>
          <input id="startYear" type="number" placeholder="2021" />
        </div>
        <div>
          <label>End Year</label>
          <input id="endYear" type="number" placeholder="2025" />
        </div>
      </div>

      <div class="actions">
        <button class="btn btn--ghost" id="addAnother" type="button">
          Save & Add Another
        </button>

        <!-- FIXED BUTTON -->
        <button type="button" class="btn btn--primary" id="saveContinue">
          Save & Continue â†’
        </button>
      </div>

    </form>
  </section>
</main>

<footer class="site-footer">Â© 2025 TalentConnect</footer>


<!-- =============== SCRIPT =============== -->
<script>
/* -------- LOCAL STORAGE -------- */
function getEdu() { return JSON.parse(localStorage.getItem("tc_education")) || []; }
function saveEdu(list) { localStorage.setItem("tc_education", JSON.stringify(list)); }

function rebuildEduList(){
  const box = document.getElementById("eduList");
  const list = getEdu();
  box.innerHTML = "";

  list.forEach((e,i)=> {
    box.innerHTML += `
      <div class="edu-box">
        <span onclick="deleteEdu(${i})" class="edu-delete">âœ–</span>
        <div class="edu-title">${e.degree} in ${e.field}</div>
        <div class="edu-dates">${e.school}<br>${e.startYear} â†’ ${e.endYear}</div>
      </div>`;
  });
}

function deleteEdu(i){
  let L = getEdu();
  L.splice(i,1);
  saveEdu(L);
  rebuildEduList();
}

function collectEducation(){
  return {
    school: school.value.trim(),
    degree: degree.value.trim(),
    field: field.value.trim(),
    startYear: startYear.value,
    endYear: endYear.value
  };
}

/* ----- ADD ANOTHER ----- */
document.getElementById("addAnother").addEventListener("click", ()=>{
  let e = collectEducation();
  if(!e.school || !e.degree){
    alert("School + Degree required");
    return;
  }
  let L = getEdu();
  L.push(e);
  saveEdu(L);

  document.getElementById("eduForm").reset();
  rebuildEduList();
});

/* -------- SAVE & CONTINUE -------- */
document.getElementById("saveContinue").addEventListener("click", async ()=> {

  let last = collectEducation();
  if(last.school && last.degree){
    let L = getEdu();
    L.push(last);
    saveEdu(L);
  }

  let eduList = getEdu();

  if(eduList.length === 0){
    alert("Add at least one education entry");
    return;
  }

  try {
    const response = await fetch("../../Backend/userinfo.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type: "education",
        education: eduList
      })
    });

    const result = await response.json();
    console.log(result);

    if(result.success){
      localStorage.removeItem("tc_education");
      window.location.href = "skills.html";
    } else {
      alert("Failed: " + result.error);
    }

  } catch (err){
    console.error(err);
    alert("Failed to save education.");
  }
});

rebuildEduList();
</script>

</body>
</html>
