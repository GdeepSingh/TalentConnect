<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sign Up â€¢ TalentConnect</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <div class="bg-dot"></div>
<div class="bg-shape a"></div>
<div class="bg-shape b"></div>

<header class="site-header">
  <div class="site-header__inner">
    <div class="brand">
      <div class="brand__logo"></div>
      <div class="brand__name">TalentConnect</div>
    </div>
    <div class="muted">
      Already have an account?
      <a href="login.html">Log in</a>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <h1 class="card__title">Create your account</h1>
    <p class="card__note">Choose Job Seeker or Employer to continue.</p>

    <form id="signupForm" novalidate>

      <label>Full Name</label>
      <input id="name" type="text" placeholder="e.g., John Singh">

      <label>Email</label>
      <input id="email" type="email" placeholder="you@email.com">

      <label>Password</label>
      <input id="password" type="password">

      <label>Re-enter Password</label>
      <input id="confirm" type="password">

      <label>Account Type</label>
      <select id="role">
        <option value="">Select one</option>
        <option value="seeker">Job Seeker</option>
        <option value="employer">Employer</option>
      </select>

      <div id="companyBox" style="display:none;">
        <label>Company Secret Code</label>
        <input id="companyCode" type="text" placeholder="Provided by company admin">
      </div>

      <p id="msg" class="card__note" style="margin-top:8px;"></p>

      <div class="actions">
        <button class="btn btn--primary" type="submit">Create Account â†’</button>
      </div>

    </form>
  </section>
</main>

<footer class="site-footer">Â© 2025 TalentConnect</footer>

<script>
/* SHOW COMPANY CODE FIELD IF EMPLOYER */
document.getElementById("role").addEventListener("change", e => {
  document.getElementById("companyBox").style.display =
    e.target.value === "employer" ? "block" : "none";
});

/* GET + SAVE USER HELPERS */
function getUsers(){
  try { return JSON.parse(localStorage.getItem("tc_users")) || []; }
  catch(e){ return []; }
}
function saveUsers(arr){
  localStorage.setItem("tc_users", JSON.stringify(arr));
}

/* SIGNUP HANDLER */
document.getElementById("signupForm").addEventListener("submit", e => {
  e.preventDefault();

  const name  = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const pass  = document.getElementById("password").value;
  const conf  = document.getElementById("confirm").value;
  const role  = document.getElementById("role").value;
  const code  = document.getElementById("companyCode").value;
  const msgEl = document.getElementById("msg");

  if(!name || !email || !pass){
    msgEl.textContent = "âš  Please fill all required fields.";
    msgEl.style.color = "red";
    return;
  }
  if(pass !== conf){
    msgEl.textContent = "âš  Passwords do not match.";
    msgEl.style.color = "red";
    return;
  }

  const users = getUsers();
  if(users.some(u => u.email === email)){
    msgEl.textContent = "âš  Account already exists.";
    msgEl.style.color = "red";
    return;
  }

  /* CREATE USER OBJECT */
  const user = {
    name,
    email,
    password: pass,
    role,                   // seeker or employer
    companyCode: code || null
  };

  users.push(user);
  saveUsers(users);

  /* ðŸš¨ IMPORTANT: CLEAR PREVIOUS USER DATA */
  localStorage.removeItem("tc_experience");
  localStorage.removeItem("tc_education");

  /* SAVE ACTIVE USER */
  localStorage.setItem("tc_active_user", JSON.stringify(user));

  /* REDIRECT */
  if(role === "employer"){
    window.location.href = "company_dashboard.html";
  } else {
    window.location.href = "experience.html";
  }
});
</script>

</body>
</html>
